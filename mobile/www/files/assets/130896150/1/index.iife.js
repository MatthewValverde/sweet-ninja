(function(di){"use strict";function ci(i){return i&&typeof i=="object"&&"default"in i?i:{default:i}}var h=ci(di);let pi={gameId:"sweet-ninja",gameVersion:"",gameModes:[{FREEPLAY:"freeplay"},{EVENT:"event"},{MAINBOARD:"mainboard"},{EVENTRANDOM:"eventrandom"}],colorKeys:[{PRIMARY:"primary"},{SECONDARY:"secondary"},{TEXT:"text"},{WIDGET:"widget"}],textureKeys:[{GAMETITLE:"gameTitle"},{LOGO1:"logo1"},{LOGO2:"logo2"}],videoKeys:[{VIDEO1:"video1"}],states:[{Playing:"playing"}],menus:[{Playing:"playing"}]};function fi(i){if(i.__esModule)return i;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(i).forEach(function(e){var s=Object.getOwnPropertyDescriptor(i,e);Object.defineProperty(t,e,s.get?s:{enumerable:!0,get:function(){return i[e]}})}),t}var he={};const f=9007199254740992,N=f-1,W=-1>>>0,v=W+1,E=v/2,Vt=E-1,z=1<<21,I=z-1;function H(i){return i.next()|0}function C(i,t){return t===0?i:e=>i(e)+t}function Z(i){const t=i.next()|0,e=i.next()>>>0;return(t&I)*v+e+(t&z?-f:0)}function Ut(i){for(;;){const t=i.next()|0;if(t&4194304){if((t&8388607)===4194304&&(i.next()|0)===0)return f}else{const e=i.next()>>>0;return(t&I)*v+e+(t&z?-f:0)}}}function jt(i){return i.next()>>>0}function K(i){const t=i.next()&I,e=i.next()>>>0;return t*v+e}function X(i){for(;;){const t=i.next()|0;if(t&z){if((t&I)===0&&(i.next()|0)===0)return f}else{const e=i.next()>>>0;return(t&I)*v+e}}}function de(i){return(i+1&i)===0}function mi(i){return t=>t.next()&i}function gi(i){const t=i+1,e=t*Math.floor(v/t);return s=>{let n=0;do n=s.next()>>>0;while(n>=e);return n%t}}function yi(i){return de(i)?mi(i):gi(i)}function vi(i){return(i|0)===0}function bi(i){return t=>{const e=t.next()&i,s=t.next()>>>0;return e*v+s}}function Ti(i){const t=i*Math.floor(f/i);return e=>{let s=0;do{const n=e.next()&I,r=e.next()>>>0;s=n*v+r}while(s>=t);return s%i}}function Si(i){const t=i+1;if(vi(t)){const e=(t/v|0)-1;if(de(e))return bi(e)}return Ti(t)}function ce(i,t){return e=>{let s=0;do{const n=e.next()|0,r=e.next()>>>0;s=(n&I)*v+r+(n&z?-f:0)}while(s<i||s>t);return s}}function M(i,t){if(i=Math.floor(i),t=Math.floor(t),i<-f||!isFinite(i))throw new RangeError(`Expected min to be at least ${-f}`);if(t>f||!isFinite(t))throw new RangeError(`Expected max to be at most ${f}`);const e=t-i;return e<=0||!isFinite(e)?()=>i:e===W?i===0?jt:C(H,i+E):e<W?C(yi(e),i):e===N?C(K,i):e<N?C(Si(e),i):t-1-i===N?C(X,i):i===-f&&t===f?Ut:i===-f&&t===N?Z:i===-N&&t===f?C(Z,1):t===f?C(ce(i-1,t-1),1):ce(i,t)}function _i(i){return(i.next()&1)===1}function kt(i,t){return e=>i(e)<t}function xi(i){if(i<=0)return()=>!1;if(i>=1)return()=>!0;{const t=i*v;return t%1===0?kt(H,t-E|0):kt(K,Math.round(i*f))}}function pe(i,t){return t==null?i==null?_i:xi(i):i<=0?()=>!1:i>=t?()=>!0:kt(M(0,t-1),i)}function fe(i,t){const e=M(+i,+t);return s=>new Date(e(s))}function Dt(i){return M(1,i)}function me(i,t){const e=Dt(i);return s=>{const n=[];for(let r=0;r<t;++r)n.push(e(s));return n}}const Ei="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_-";function Y(i=Ei){const t=i.length;if(!t)throw new Error("Expected pool not to be an empty string");const e=M(0,t-1);return(s,n)=>{let r="";for(let o=0;o<n;++o){const a=e(s);r+=i.charAt(a)}return r}}const ge="0123456789abcdef",Mi=Y(ge),Ci=Y(ge.toUpperCase());function ye(i){return i?Ci:Mi}function ve(i,t){return i<0?Math.max(i+t,0):Math.min(i,t)}function be(i){const t=+i;return t<0?Math.ceil(t):Math.floor(t)}function Te(i,t,e,s){const n=t.length;if(n===0)throw new RangeError("Cannot pick from an empty array");const r=e==null?0:ve(be(e),n),o=s===void 0?n:ve(be(s),n);if(r>=o)throw new RangeError(`Cannot pick between bounds ${r} and ${o}`);const a=M(r,o-1);return t[a(i)]}function Pi(i,t){return t===1?i:t===0?()=>0:e=>i(e)*t}function Bt(i){return K(i)/f}function Nt(i){return X(i)/f}function Se(i,t,e=!1){if(isFinite(i)){if(!isFinite(t))throw new RangeError("Expected max to be a finite number")}else throw new RangeError("Expected min to be a finite number");return C(Pi(e?Nt:Bt,t-i),i)}const _e=Array.prototype.slice;function q(i,t,e=0){const s=t.length;if(s)for(let n=s-1>>>0;n>e;--n){const o=M(0,n)(i);if(n!==o){const a=t[n];t[n]=t[o],t[o]=a}}return t}function xe(i,t,e){if(e<0||e>t.length||!isFinite(e))throw new RangeError("Expected sampleSize to be within 0 and the length of the population");if(e===0)return[];const s=_e.call(t),n=s.length;if(n===e)return q(i,s,0);const r=n-e;return q(i,s,r-1).slice(r)}const wi=(()=>{try{if("x".repeat(3)==="xxx")return(i,t)=>i.repeat(t)}catch{}return(i,t)=>{let e="";for(;t>0;)t&1&&(e+=i),t>>=1,i+=i;return e}})();function F(i,t){return wi("0",t-i.length)+i}function Ee(i){const t=i.next()>>>0,e=i.next()|0,s=i.next()|0,n=i.next()>>>0;return F(t.toString(16),8)+"-"+F((e&65535).toString(16),4)+"-"+F((e>>4&4095|16384).toString(16),4)+"-"+F((s&16383|32768).toString(16),4)+"-"+F((s>>4&65535).toString(16),4)+F(n.toString(16),8)}const zt={next(){return Math.random()*v|0}};class Oi{constructor(t=zt){this.engine=t}int32(){return H(this.engine)}uint32(){return jt(this.engine)}uint53(){return K(this.engine)}uint53Full(){return X(this.engine)}int53(){return Z(this.engine)}int53Full(){return Ut(this.engine)}integer(t,e){return M(t,e)(this.engine)}realZeroToOneInclusive(){return Nt(this.engine)}realZeroToOneExclusive(){return Bt(this.engine)}real(t,e,s=!1){return Se(t,e,s)(this.engine)}bool(t,e){return pe(t,e)(this.engine)}pick(t,e,s){return Te(this.engine,t,e,s)}shuffle(t){return q(this.engine,t)}sample(t,e){return xe(this.engine,t,e)}die(t){return Dt(t)(this.engine)}dice(t,e){return me(t,e)(this.engine)}uuid4(){return Ee(this.engine)}string(t,e){return Y(e)(this.engine,t)}hex(t,e){return ye(e)(this.engine,t)}date(t,e){return fe(t,e)(this.engine)}}const Me=(()=>{try{const i=new ArrayBuffer(4),t=new Int32Array(i);if(t[0]=E,t[0]===-E)return Int32Array}catch{}return Array})();let J=null;const Kt=128;let $t=Kt;const Ii={next(){return $t>=Kt&&(J===null&&(J=new Me(Kt)),crypto.getRandomValues(J),$t=0),J[$t++]|0}};function Ce(i=zt,t=16){const e=[];e.push(new Date().getTime()|0);for(let s=1;s<t;++s)e[s]=i.next()|0;return e}const Gt=(()=>{try{if(Math.imul(W,5)===-5)return Math.imul}catch{}const i=65535;return(t,e)=>{const s=t>>>16&i,n=t&i,r=e>>>16&i,o=e&i;return n*o+(s*o+n*r<<16>>>0)|0}})(),_=624,P=_-1,Wt=397,Pe=_-Wt,Ht=2567483615;class ${constructor(){this.data=new Me(_),this.index=0,this.uses=0}static seed(t){return new $().seed(t)}static seedWithArray(t){return new $().seedWithArray(t)}static autoSeed(){return $.seedWithArray(Ce())}next(){(this.index|0)>=_&&(Zt(this.data),this.index=0);const t=this.data[this.index];return this.index=this.index+1|0,this.uses+=1,Ai(t)|0}getUseCount(){return this.uses}discard(t){if(t<=0)return this;for(this.uses+=t,(this.index|0)>=_&&(Zt(this.data),this.index=0);t+this.index>_;)t-=_-this.index,Zt(this.data),this.index=0;return this.index=this.index+t|0,this}seed(t){let e=0;this.data[0]=e=t|0;for(let s=1;s<_;s=s+1|0)this.data[s]=e=Gt(e^e>>>30,1812433253)+s|0;return this.index=_,this.uses=0,this}seedWithArray(t){return this.seed(19650218),Li(this.data,t),this}}function Zt(i){let t=0,e=0;for(;(t|0)<Pe;t=t+1|0)e=i[t]&E|i[t+1|0]&Vt,i[t]=i[t+Wt|0]^e>>>1^(e&1?Ht:0);for(;(t|0)<P;t=t+1|0)e=i[t]&E|i[t+1|0]&Vt,i[t]=i[t-Pe|0]^e>>>1^(e&1?Ht:0);e=i[P]&E|i[0]&Vt,i[P]=i[Wt-1]^e>>>1^(e&1?Ht:0)}function Ai(i){return i^=i>>>11,i^=i<<7&2636928640,i^=i<<15&4022730752,i^i>>>18}function Li(i,t){let e=1,s=0;const n=t.length;let r=Math.max(n,_)|0,o=i[0]|0;for(;(r|0)>0;--r)i[e]=o=(i[e]^Gt(o^o>>>30,1664525))+(t[s]|0)+(s|0)|0,e=e+1|0,++s,(e|0)>P&&(i[0]=i[P],e=1),s>=n&&(s=0);for(r=P;(r|0)>0;--r)i[e]=o=(i[e]^Gt(o^o>>>30,1566083941))-e|0,e=e+1|0,(e|0)>P&&(i[0]=i[P],e=1);i[0]=E}let we=null;const Xt=128;let Yt=Xt;const Ri={next(){return Yt>=Xt&&(we=new Int32Array(new Int8Array(require("crypto").randomBytes(4*Xt)).buffer),Yt=0),we[Yt++]|0}};function Fi(i,t,e){const s=_e.call(i,t,e);if(s.length===0)throw new RangeError("Cannot pick from a source with no items");const n=M(0,s.length-1);return r=>s[n(r)]}var Vi=Object.freeze(Object.defineProperty({__proto__:null,Random:Oi,browserCrypto:Ii,nativeMath:zt,MersenneTwister19937:$,nodeCrypto:Ri,bool:pe,date:fe,dice:me,die:Dt,hex:ye,int32:H,int53:Z,int53Full:Ut,integer:M,pick:Te,picker:Fi,real:Se,realZeroToOneExclusive:Bt,realZeroToOneInclusive:Nt,sample:xe,shuffle:q,string:Y,uint32:jt,uint53:K,uint53Full:X,uuid4:Ee,createEntropy:Ce},Symbol.toStringTag,{value:"Module"})),qt=fi(Vi),Q={};Object.defineProperty(Q,"__esModule",{value:!0}),Q.AppController=void 0;const Oe=h.default,Ui=qt,Ie=qt,Jt=h.default;class S extends Oe.ScriptType{constructor(){super(...arguments),this.initialize=function(){this.app.controller=this,this.setAppVariables(),this.setPromises(),this.muteAppUntilInput(),this.waitForGameSetupComplete();var t=this,e=setInterval(function(){t.app.gameController!==void 0&&(clearInterval(e),console.log("exists"),t.start())},100)},this.start=function(){this.app.inPlayCanvas?this.startPlayCanvasGame():this.startPlatformGame()},this.setAppVariables=function(){this.app.stateNum=-1,this.app.platform=this.getPlatform(),this.app.inPlayCanvas=this.getInPlayCanvas()},this.setPromises=function(){this.createPromise("configLoaded"),this.createPromise("input"),this.createPromise("imagesLoaded"),this.createPromise("assetsLoaded"),this.createPromise("videosLoaded")},this.muteAppUntilInput=function(){this.app.systems.sound.volume=0,Promise.all([this.app.configLoadedPromise,this.app.inputPromise]).then(()=>{(this.app.inPlayCanvas===!0||this.app.mode.includes("freeplay")||this.app.mode.includes("event"))&&this.app.tween(this.app.systems.sound.manager).to({volume:1},.5,Jt.SineInOut).start()})},this.startPlayCanvasGame=function(){this.parseConfig(this.playcanvasConfigJson.resource)},this.startPlatformGame=function(){window.addEventListener("message",this.receiveMessage.bind(this)),this.sendMessage({event:"ready",apiVersion:1})},this.waitForGameSetupComplete=function(){Promise.all([this.app.configLoadedPromise,this.app.imagesLoadedPromise,this.app.assetsLoadedPromise,this.app.videosLoadedPromise]).then(()=>{if(this.selfRanStates=this.app.inPlayCanvas===!0||this.app.mode==="freeplay",this.setStatesFromJson(this.stateJson.resource),this.forceSetState(this.app.states[0].name),this.app.settings!==void 0&&this.app.settings.timers!==void 0&&this.selfRanStates&&Object.keys(this.app.settings.timers).forEach(t=>this.loadTimer(t,this.app.settings.timers[t])),this.app.stateStartTime=this.app.inPlayCanvas===!0&&this.app.mode!=="freeplay"?Date.now():void 0,this.app.setting_font1!==void 0&&this.app.setting_font1!=="")for(let t=0;t<this.fontNames.length;t++)this.app.setting_font1===this.fontNames[t]&&(this.font1Id=t,this.app.customFont1=this.fonts[this.font1Id]);if(this.app.setting_font2!==void 0&&this.app.setting_font2!=="")for(let t=0;t<this.fontNames.length;t++)this.app.setting_font2===this.fontNames[t]&&(this.font2Id=t,this.app.customFont2=this.fonts[this.font2Id]);this.app.fire("initializationComplete"),this.sendMessage({event:"initialization_complete"})})},this.setStatesFromJson=function(t){this.app.states=t[this.app.mode]===void 0?t.default:t[this.app.mode]},this.loadTimer=function(t,e){for(let s=0;s<this.app.states.length;s++)t===this.app.states[s].timeVar&&(this.app.states[s].duration=e)},this.update=function(t){this.selfRanStates===!0&&this.app.stateStartTime},this.receiveMessage=function(t){if(Object.values(t.data).length===0){this.app.logger.log("recieved message with no data",t);return}const{event:e,data:s,requestType:n}=t.data;switch(e){case"config":this.app.logger.log(e,"received",s),this.app.config===void 0&&this.parseConfig(s);break;case"state":this.app.logger.log(e,"received",s.data),this.parseState(s.data);break;case"response":switch(n){case"get_leaderboard":this.handleIncomingLeaderboard(t.data);break;case"get_leader_entry":this.handleIncomingLeader(t.data);break}break;case"resetGame":this.setRandomSeed(s.seed?s.seed:void 0),this.app.canReset===!0&&(this.app.canReset=!1,this.app.fire("resetGame"));break;case"muteGame":this.app.systems.sound.volume=0,this.app.fire("mute");break;case"unmuteGame":this.app.fire("unmute"),this.app.systems.sound.volume=1;break;default:this.app.logger.log("Unsupported message",t.data);break}},this.setRandomSeed=function(t){this.app.random=new Ui.Random(t?Ie.MersenneTwister19937.seed(t):Ie.MersenneTwister19937.autoSeed())},this.parseConfig=function(t){this.app.config=t,this.app.mode=t.mode,this.app.logger.log("App Running in "+this.app.mode+" mode."),t.design?this.parseDesign(t.design):(this.app.imagesLoadedResolver(),this.app.videosLoadedResolver()),t.settings?this.parseSettings(t.settings):(this.app.settings={},this.app.fire("settingsLoaded")),this.app.configLoadedResolver(),this.app.fire("configLoaded")},this.parseDesign=function(t){const{colors:e,images:s,videos:n}=t;e&&Object.values(e).length>0&&(this.app.colors=e,this.app.logger.log("LOADING COLORS:",e),Object.keys(e).forEach(r=>this.setColor(r,e[r]))),s&&Object.values(s).length>0?(this.app.numberOfCustomImages=0,Object.keys(s).forEach(r=>this.checkEmptyOrAdd(s[r],"Images")),this.app.logger.log("LOADING IMAGES:",s),this.app.customImagesLoaded=0,Object.keys(s).forEach(r=>this.setImage(r,s[r])),this.app.numberOfCustomImages===0&&this.app.imagesLoadedResolver()):this.app.imagesLoadedResolver(),n&&Object.values(n).length>0?(this.app.numberOfCustomVideos=0,Object.keys(n).forEach(r=>this.checkEmptyOrAdd(n[r],"Videos")),this.app.logger.log("LOADING VIDEOS",n),this.app.customVideosLoaded=0,Object.keys(n).forEach(r=>this.setVariable(r,n[r])),this.app.numberOfCustomVideos===0&&this.app.videosLoadedResolver()):this.app.videosLoadedResolver()},this.checkEmptyOrAdd=function(t,e){t===""||t===void 0||(this.app["numberOfCustom"+e]+=1)},this.setColor=function(t,e){if(!(e===""||e===void 0)){var s=new Jt.Color().fromString(e);this.app["color_"+t]=s,this.app.fire("setColor_"+t)}},this.setImage=function(t,e){if(!(e===""||e===void 0)){var s=new Image;s.crossOrigin="anonymous",s.onload=(()=>{var n=new Jt.Texture(this.app.graphicsDevice);n.anisotropy=16,n.mipmaps=!0,n.setSource(s),this.app["texture_"+t]=n,this.app.fire("setTexture_"+t,n),this.app.customImagesLoaded+=1,this.app.customImagesLoaded===this.app.numberOfCustomImages&&this.app.imagesLoadedResolver()}).bind(this),s.src=e.url!==void 0?e.url:e}},this.parseSettings=function(t){Object.values(t).length>0?(this.app.settings=t,Object.keys(t).forEach(e=>this.setVariable(e,t[e],t))):this.app.settings={},this.app.fire("settingsLoaded")},this.setVariable=function(t,e,s){this.app["setting_"+t]=e.url!==void 0?e.url:e,this.app.fire(t,this.app[t])},this.parseState=function(t){const{sid:e,gameStateInfo:s,stateStartTime:n,stateName:r,stateDuration:o}=t;e!==void 0?(this.app.sessionId===void 0&&(this.socketMultiplayer&&this.subscribeToMultiplayer(),this.app.sessionId=e,this.app.gameController.joinEvent()),this.startState(r,n,o)):this.app.stateStartTime===void 0&&(this.app.gameController.leaveEvent(),this.app.sessionId=void 0,this.app.stateStartTime=void 0,this.socketMultiplayer&&this.unsubscribeFromMultiplayer())},this.forceSetState=function(t){this.interval&&clearInterval(this.interval);for(let e=0;e<this.app.states.length;e++)if(t===this.app.states[e].name){this.app.stateNum=e,this.startState(this.app.states[e].name,Date.now(),this.app.states[e].duration);return}},this.startState=function(t,e,s){this.app.logger.log("stateStart:",t," Time: ",s),this.app.menuName=t,this.app.stateName=t,this.app.fire("stateSet"),this.app.fire("stateStart_"+t),s>0&&this.trackStateTime(t,s)},this.goToNextState=function(){if(this.selfRanStates){var t=this.app.states[this.app.stateNum+1].name;this.forceSetState(t)}},this.delay=function(t){return new Promise(e=>{setTimeout(e,t)})},this.trackStateTime=function(t,e){if(e===0)return;let s=e;this.interval&&clearInterval(this.interval),this.app.fire("timer_"+t,s),this.interval=setInterval(()=>{s--,this.app.fire("timer_"+t,s),s===0&&(clearInterval(this.interval),this.goToNextState())},1e3)},this.sendMessage=function(t){this.app.logger.log("Sending Message",t),parent.postMessage(t,"*")},this.sendScore=function(t){this.sendMessage({id:0,event:"award_points",data:{leaderboards:[this.getLeaderboardId()],amount:t}})},this.requestLeaderboard=function(t){var e=t===void 0?this.app.mode.includes("mainboard")?this.mainboardLeaderboardCount:this.leaderboardCount:t;this.sendMessage({id:0,event:"get_leaderboard",data:{leaderboard:this.leaderboardID,topLeadersLimit:e}}),this.app.mode.includes("mainboard")||this.sendMessage({event:"get_leader_entry",data:{leaderboard:this.getLeaderboardId()}})},this.getLeaderboardId=function(){return this.app.mode==="freeplay"?`freeplay-${this.gameId}`:`${this.gameId}-${this.app.sessionId}`},this.getPlatform=function(){const t=navigator.userAgent||navigator.vendor||window.opera;var e;return/windows phone/i.test(t)?e="Windows Phone":/android/i.test(t)?e="Android":/iPad|iPhone|iPod/.test(t)&&!window.MSStream?e="iOS":e="desktop",e},this.getInPlayCanvas=function(){var t=window.location.href;return this.app.logger.log("pageUrl",t),!!t.includes("playcanv")}}createPromise(t){this.app[t+"Promise"]=new Promise(e=>this.app[t+"Resolver"]=e)}subscribeToMultiplayer(){}unsubscribeFromMultiplayer(){}}Q.AppController=S,(0,Oe.registerScript)(S,"appController"),S.attributes.add("gameId",{type:"string",default:"game-id"}),S.attributes.add("socketMultiplayer",{type:"boolean",default:!1}),S.attributes.add("leaderboardCount",{type:"number",default:5}),S.attributes.add("mainboardLeaderboardCount",{type:"number",default:10}),S.attributes.add("capFramerate",{type:"boolean",default:!1}),S.attributes.add("playcanvasConfigJson",{type:"asset",title:"PlayCan Config JSON",assetType:"json",description:"testConfig.json in the base folder - Change your settings in this file for test modes"}),S.attributes.add("stateJson",{type:"asset",title:"State JSON",assetType:"json",description:"state setup for the game"}),S.attributes.add("fontNames",{type:"string",array:!0}),S.attributes.add("fonts",{type:"asset",assetType:"font",array:!0});var tt={};Object.defineProperty(tt,"__esModule",{value:!0}),tt.EnableUiMulti=void 0;const Ae=h.default;class Le extends Ae.ScriptType{constructor(){super(...arguments),this.initialize=function(){this.app.on("stateSet",this.checkEnable,this),this.app.on("menuSet",this.checkEnable,this)},this.checkEnable=function(t){var e=!1;for(let n=0;n<this.enabledStates.length;n++)this.app.stateName===this.enabledStates[n]&&(e=!0);var s=!1;for(let n=0;n<this.enabledMenus.length;n++)this.app.menuName===this.enabledMenus[n]&&(s=!0);e===!0&&s===!0?this.entity.enabled=!0:this.entity.enabled=!1}}}tt.EnableUiMulti=Le,(0,Ae.registerScript)(Le,"enableUiMulti");var et={};Object.defineProperty(et,"__esModule",{value:!0}),et.DeleteAfterTime=void 0;const Re=h.default;class Qt extends Re.ScriptType{constructor(){super(...arguments),this.initialize=function(){setTimeout(()=>{this.entity.destroy()},this.delay*1e3)}}}et.DeleteAfterTime=Qt,(0,Re.registerScript)(Qt,"deleteAfterTime"),Qt.attributes.add("delay",{type:"number"});var it={};Object.defineProperty(it,"__esModule",{value:!0}),it.SceneLoader=void 0;const Fe=h.default,Ve=h.default;class te extends Fe.ScriptType{constructor(){super(...arguments),this.initialize=function(){for(let e=0;e<this.gameThemes.length;e++){this.app.on(this.gameThemes[e],this.loadScene,this);var t=new Ve.Entity;t.reparent(this.entity),t.name=this.gameThemes[e]}this.isCustom=!1},this.loadScene=function(t,e,s){this.app.logger.log("loading scene: "+t+"_"+e);var n=this.app.root.findByName(t);this.app.logger.log("sceneRoot",n),n.children.length>0&&n.children[0].destroy();var r=this.app.scenes.find(t+"_"+e);this.app.scenes.loadSceneHierarchy(r.url,function(o,a){if(o)console.error(o);else{a.reparent(n);var u=Ve.app;u.camera=u.root.findByName("PlayerCamera"),u.batcher.generate(),u.lightmapper.bake()}}),s&&this.app.fire("customTheme",s)}}}it.SceneLoader=te,(0,Fe.registerScript)(te,"sceneLoader"),te.attributes.add("gameThemes",{type:"string",array:!0});var st={};Object.defineProperty(st,"__esModule",{value:!0}),st.SetMaterialColor=void 0;const Ue=h.default;class nt extends Ue.ScriptType{constructor(){super(...arguments),this.initialize=function(){this.app.on("setColor_"+this.colorKey,this.setColor,this),this.material=void 0,this.app["color_"+this.colorKey]&&this.setColor()},this.setColor=function(){this.material||this.setTargetMaterial(),this.setDiffuse===!0&&this.material.diffuse.set(this.app["color_"+this.colorKey].r,this.app["color_"+this.colorKey].g,this.app["color_"+this.colorKey].b),this.setEmissive===!0&&this.material.emissive.set(this.app["color_"+this.colorKey].r,this.app["color_"+this.colorKey].g,this.app["color_"+this.colorKey].b),this.material.update()},this.setTargetMaterial=function(){this.entity.render&&(this.material=this.entity.render.meshInstances[0].material),this.entity.model&&(this.material=this.entity.model.meshInstances[0].material)}}}st.SetMaterialColor=nt,(0,Ue.registerScript)(nt,"setMaterialColor"),nt.attributes.add("setDiffuse",{type:"boolean",default:!0}),nt.attributes.add("setEmissive",{type:"boolean",default:!1});var rt={};Object.defineProperty(rt,"__esModule",{value:!0}),rt.SetMaterialTexture=void 0;const je=h.default;class ot extends je.ScriptType{constructor(){super(...arguments),this.initialize=function(){this.app.on("setTexture_"+this.textureKey,this.setTexture,this),this.material=void 0,this.setTargetMaterial(),this.app["texture_"+this.textureKey]&&this.setColor()},this.setTexture=function(t){this.material===void 0&&this.setTargetMaterial(),this.material.diffuseMap=t,this.setOpacity===!0&&(this.material.opacityMap=t,this.material.opacity=1),this.setEmissive===!0&&(this.material.emissiveMap=t),this.material.update()},this.setTargetMaterial=function(){this.entity.render&&(this.material=this.entity.render.meshInstances[0].material),this.entity.model&&(this.material=this.entity.model.meshInstances[0].material)}}}rt.SetMaterialTexture=ot,(0,je.registerScript)(ot,"setMaterialTexture"),ot.attributes.add("setOpacity",{type:"boolean",default:!1}),ot.attributes.add("setEmissive",{type:"boolean",default:!1});var at={};Object.defineProperty(at,"__esModule",{value:!0}),at.SetMaterialVideoTexture=void 0;const ke=h.default,w=h.default;class O extends ke.ScriptType{constructor(){super(...arguments),this.initialize=function(){this.canUpload=!1,this.videoElementCreated=!1,this.app.on("configLoaded",this.initVideoAndRun,this),this.app.on(this.videoKey+"_set",this.setManualVideo,this),this.app.on(this.videoKey+"_play",this.playVideo,this),this.app.on(this.videoKey+"_pause",this.pauseVideo,this),this.app.on(this.videoKey+"_vol",this.setVolume,this),this.mat=this.entity.render.meshInstances[0].material,this.manualUrl=void 0},this.setVolume=function(t){this.video.volume=t},this.setManualVideo=function(t){this.videoElementCreated||this.createVideoElement(),this.manualUrl=t,this.unloadVideo(),this.loadVideo()},this.createVideoElement=function(){this.video=document.createElement("video"),this.video.autoplay=this.autoPlayVideo,this.video.crossOrigin="anonymous",this.video.loop=this.loopVideo,this.video.volume=this.volume,this.video.muted=this.startMuted,this.video.playsInline=!0;let t=this.video.style;t.width="1px",t.height="1px",t.position="absolute",t.opacity="0",t.zIndex="-1000",t.pointerEvents="none",document.body.appendChild(this.video),this.videoElementCreated=!0,this.videoTexture=new w.Texture(this.app.graphicsDevice,{format:w.PIXELFORMAT_R8_G8_B8,minFilter:w.FILTER_LINEAR_MIPMAP_LINEAR,magFilter:w.FILTER_LINEAR,addressU:w.ADDRESS_CLAMP_TO_EDGE,addressV:w.ADDRESS_CLAMP_TO_EDGE,mipmaps:!1}),this.videoTexture.setSource(this.video),this.video.addEventListener("canplay",function(e){this.mat.diffuse.set(0,0,0),this.mat.diffuseMap=this.blankTexture.resource,this.mat.emissiveMap=this.videoTexture,this.mat.update()}.bind(this))},this.initVideoAndRun=function(){(this.app["setting_"+this.videoKey]===""||this.app["setting_"+this.videoKey]===void 0)&&this.defaultUrl===""||(this.app["setting_"+this.videoKey].endsWith(".jpg")||this.app["setting_"+this.videoKey].endsWith(".png")?this.setImage(this.app["setting_"+this.videoKey]):(this.videoElementCreated||this.createVideoElement(),this.loadVideo(),this.autoPlayOnFirstLoad&&this.playVideo()))},this.setImage=function(t){if(!(t===""||t===void 0)){var e=new Image;e.crossOrigin="anonymous",e.onload=(()=>{var s=new w.Texture(this.app.graphicsDevice);s.anisotropy=16,s.mipmaps=!0,s.setSource(e),this.mat.diffuse.set(1,1,1),this.mat.diffuseMap=s,this.mat.emissiveMap=s,this.mat.opacityMap=s,this.mat.blendType=w.BLEND_NONE,this.mat.opacityMapChannel="a",this.mat.alphaToCoverage=!0,this.mat.update()}).bind(this),e.src=t.url!==void 0?t.url:t}},this.unloadVideo=function(){this.canUpload=!1,this.video&&(this.video.pause(),this.video.removeAttribute("src"),this.video.load())},this.loadVideo=function(){this.canUpload=!0,this.defaultUrl!==""&&(this.app["setting_"+this.videoKey]===void 0||this.app["setting_"+this.videoKey]==="")&&(this.manualUrl=this.defaultUrl),this.video.src=this.manualUrl===void 0?this.app["setting_"+this.videoKey]:this.manualUrl,this.video.load(),this.app.customVideosLoaded+=1,(this.app.customVideosLoaded=this.app.numberOfCustomVideos)&&this.app.videosLoadedResolver()},this.playVideo=function(){this.video.play()},this.pauseVideo=function(){this.video.pause()},this.update=function(t){this.canUpload&&this.videoTexture.upload()}}}at.SetMaterialVideoTexture=O,(0,ke.registerScript)(O,"setMaterialVideoTexture"),O.attributes.add("defaultUrl",{type:"string"}),O.attributes.add("blankTexture",{type:"asset",assetType:"texture"}),O.attributes.add("autoPlayOnFirstLoad",{type:"boolean",default:!0}),O.attributes.add("loopVideo",{type:"boolean",default:!0}),O.attributes.add("volume",{type:"number",default:.5}),O.attributes.add("startMuted",{type:"boolean",default:!0});var ut={};Object.defineProperty(ut,"__esModule",{value:!0}),ut.SetTextOnEvent=void 0;const De=h.default,ji=h.default;class A extends De.ScriptType{constructor(){super(...arguments),this.initialize=function(){for(let t=0;t<this.onFireEvents.length;t++)this.app.on(this.onFireEvents[t],this.setText,this);this.ele=this.entity.element,this.app.on("startGame",this.reset,this)},this.reset=function(){this.app[this.onFireEvents[0]+"Prev"]=0},this.setText=function(t){this.lerpNumber===!0?this.setLerpNumber(t):this.digitalClockFormat===!0?this.ele.text=this.toDigitalClock(t):this.ordinalSuffixFormat===!0?this.ele.text=this.toOrdinalSuffix(t):this.ele.text=this.preText+t},this.setLerpNumber=function(t){this.app[this.onFireEvents[0]+"Prev"]||(this.app[this.onFireEvents[0]+"Prev"]=0);const e={x:this.app[this.onFireEvents[0]+"Prev"]};this.animTween&&this.animTween.stop(),this.animTween=this.entity.tween(e).to({x:t},1,ji.Linear).on("update",()=>{this.ele.text=this.preText+Math.round(e.x)}).start()},this.toDigitalClock=t=>{const e=typeof t=="number"&&t>=0?t:0,s=Math.floor(e/60),n=Math.floor(e%60),r=s>=10?`${s}`:`0${s}`,o=n>=10?`${n}`:`0${n}`;return`${r}:${o}`},this.toOrdinalSuffix=t=>{var e=t%10,s=t%100;return e==1&&s!=11?t+"st":e==2&&s!=12?t+"nd":e==3&&s!=13?t+"rd":t+"th"}}}ut.SetTextOnEvent=A,(0,De.registerScript)(A,"setTextOnEvent"),A.attributes.add("onFireEvents",{type:"string",array:!0}),A.attributes.add("preText",{type:"string"}),A.attributes.add("digitalClockFormat",{type:"boolean",default:!1}),A.attributes.add("ordinalSuffixFormat",{type:"boolean",default:!1}),A.attributes.add("lerpNumber",{type:"boolean",default:!1});var lt={};Object.defineProperty(lt,"__esModule",{value:!0}),lt.SetTextFont=void 0;const Be=h.default;class ee extends Be.ScriptType{constructor(){super(...arguments),this.initialize=function(){this.app.on("initializationComplete",this.setFont,this)},this.setFont=function(){this.app["customFont"+this.fontId]!==void 0&&(this.entity.element.fontAsset=this.app["customFont"+this.fontId])}}}lt.SetTextFont=ee,(0,Be.registerScript)(ee,"setTextFont"),ee.attributes.add("fontId",{type:"number",default:1});var ht={};Object.defineProperty(ht,"__esModule",{value:!0}),ht.SetUiColor=void 0;const Ne=h.default;class ze extends Ne.ScriptType{constructor(){super(...arguments),this.initialize=function(){this.app.on("setColor_"+this.colorKey,this.setColor,this),this.app["color_"+this.colorKey]&&this.setColor()},this.setColor=function(){this.entity.element.color=this.app["color_"+this.colorKey]}}}ht.SetUiColor=ze,(0,Ne.registerScript)(ze,"setUiColor");var dt={};Object.defineProperty(dt,"__esModule",{value:!0}),dt.SetUiTexture=void 0;const Ke=h.default;class ct extends Ke.ScriptType{constructor(){super(...arguments),this.initialize=function(){this.width=this.entity.element.width,this.height=this.entity.element.height,this.app.on("setTexture_"+this.textureKey,this.setTexture,this),this.app["texture_"+this.textureKey]&&this.setTexture()},this.setTexture=function(){this.disableEntityOnSet&&(this.disableEntityOnSet.enabled=!1),this.entity.element.texture=this.app["texture_"+this.textureKey],this.fitImageToArea===!0&&this.fit(),this.entity.element.opacity=1},this.fit=function(){var t=this.app["texture_"+this.textureKey].width/this.app["texture_"+this.textureKey].height,e=this.width/this.height,s=0,n=0;t>e?(s=this.width,n=this.width/t):(n=this.height,s=this.height*t),this.entity.element.width=s,this.entity.element.height=n}}}dt.SetUiTexture=ct,(0,Ke.registerScript)(ct,"setUiTexture"),ct.attributes.add("disableEntityOnSet",{type:"entity"}),ct.attributes.add("fitImageToArea",{type:"boolean",default:!0});var pt={};Object.defineProperty(pt,"__esModule",{value:!0}),pt.SetParticleColor=void 0;const $e=h.default;class Ge extends $e.ScriptType{constructor(){super(...arguments),this.initialize=function(){this.app.on("configLoaded",this.setColors,this)},this.setColors=function(){for(let t=0;t<this.colorKey.length&&t<this.entity.particlesystem.colorGraph.curves[0].keys.length;t++)this.app["color_"+this.colorKey[t]]!==void 0&&this.app["color_"+this.colorKey[t]]!==null&&(this.entity.particlesystem.colorGraph.curves[0].keys[t][1]=this.app["color_"+this.colorKey[t]].r,this.entity.particlesystem.colorGraph.curves[1].keys[t][1]=this.app["color_"+this.colorKey[t]].g,this.entity.particlesystem.colorGraph.curves[2].keys[t][1]=this.app["color_"+this.colorKey[t]].b);this.entity.particlesystem.rebuild()}}}pt.SetParticleColor=Ge,(0,$e.registerScript)(Ge,"setParticleColor");var ft={};Object.defineProperty(ft,"__esModule",{value:!0}),ft.UiLeaderboard=void 0;const We=h.default;class mt extends We.ScriptType{constructor(){super(...arguments),this.initialize=function(){this.app.on("updateLeader",this.updateLeader,this),this.app.on("clearLeaderboard",this.clear,this)},this.clear=function(){for(let t=0;t<this.names;t++)this.names[t].element.text="",this.scores[t].element.text=""},this.updateLeader=function(e,s,n){this.names[e]&&(this.names[e].element.text=s,this.scores[e].element.text=n)}}}ft.UiLeaderboard=mt,(0,We.registerScript)(mt,"uiLeaderboard"),mt.attributes.add("names",{type:"entity",array:!0}),mt.attributes.add("scores",{type:"entity",array:!0});var gt={};Object.defineProperty(gt,"__esModule",{value:!0}),gt.InputMouseTouch=void 0;const He=h.default,L=h.default;class Ze extends He.ScriptType{constructor(){super(...arguments),this.initialize=function(){this.down=!1,this.app.input=this,this.app.mouse&&(this.app.mouse.on(L.EVENT_MOUSEDOWN,this.handleMouseDown,this),this.app.mouse.on(L.EVENT_MOUSEMOVE,this.handleMouseMove,this),this.app.mouse.on(L.EVENT_MOUSEUP,this.handleMouseUp,this)),this.app.touch&&(this.app.touch.on(L.EVENT_TOUCHSTART,this.handleTouchDown,this),this.app.touch.on(L.EVENT_TOUCHMOVE,this.handleTouchMove,this),this.app.touch.on(L.EVENT_TOUCHEND,this.handleTouchUp,this))},this.handleMouseDown=function(t){this.onDown(t.x,t.y)},this.handleTouchDown=function(t){this.onDown(t.touches[0].x,t.touches[0].y)},this.handleMouseMove=function(t){t.buttons[L.MOUSEBUTTON_LEFT]&&this.onMove(t.x,t.y)},this.handleTouchMove=function(t){this.onMove(t.touches[0].x,t.touches[0].y)},this.handleMouseUp=function(t){this.onUp(t.x,t.y)},this.handleTouchUp=function(t){this.onUp()},this.onDown=function(t,e){this.app.input&&this.app.input.onDown(t,e),this.down=!0},this.onMove=function(t,e){this.app.input&&this.app.input.updateMove(t,e)},this.onUp=function(t,e){this.app.input&&this.app.input.onUp(t,e),this.down=!1}}}gt.InputMouseTouch=Ze,(0,He.registerScript)(Ze,"inputMouseTouch");var yt={};Object.defineProperty(yt,"__esModule",{value:!0}),yt.AppRenderer=void 0;const Xe=h.default,ie=h.default;class vt extends Xe.ScriptType{constructor(){super(...arguments),this.initialize=function(){this.app.gameRender=this,this.rafId=null,this.mediaRecorder=null,this.chunks=[],this.fps=0,this.setResolution(),window.addEventListener("resize",this.setResolution.bind(this)),this.lastTime=performance.now(),this.deltaTimeAccumulator=0,this.frameDuration=1e3/this.targetFps,this.renderedFrames=0,this.app.on("settingsLoaded",this.start,this)},this.start=function(){this.app.setting_showFps===!0&&this.startFpsCounter(),this.app.autoRender=!1,this.rafId=requestAnimationFrame(this.renderLoop.bind(this))},this.startFpsCounter=function(){this.initializeFpsDisplay(),setInterval(()=>{this.fps=this.renderedFrames,this.fpsDisplay.textContent=`FPS: ${Math.round(this.fps)}`,this.renderedFrames=0},1e3)},this.setResolution=function(){var t=window.innerWidth/window.innerHeight,e=1080,s=e*t,n=ie.Application.getApplication();n.setCanvasResolution(ie.RESOLUTION_FIXED,s,e),n.setCanvasFillMode(ie.FILLMODE_FILL_WINDOW)},this.initializeFpsDisplay=function(){this.fpsDisplay=document.createElement("div"),this.fpsDisplay.id="fps-display",this.fpsDisplay.style.position="absolute",this.fpsDisplay.style.top="10px",this.fpsDisplay.style.left="10px",this.fpsDisplay.style.zIndex="9999",this.fpsDisplay.style.color="white",this.fpsDisplay.style.backgroundColor="black",this.fpsDisplay.style.padding="5px",document.body.appendChild(this.fpsDisplay)},this.renderLoop=function(t){var e=t-this.lastTime;this.deltaTimeAccumulator+=e,this.deltaTimeAccumulator>=this.frameDuration&&(this.app.gameController.onFrameRender(e/1e3),this.app.render(),this.deltaTimeAccumulator-=this.frameDuration,this.renderedFrames++),this.lastTime=t,this.rafId=requestAnimationFrame(this.renderLoop.bind(this))},this.initializeMediaRecorder=function(t){for(var e=[{mimeType:"video/webm; codecs=vp9",bitsPerSecond:this.recordingBps},{mimeType:"video/webm; codecs=vp8",bitsPerSecond:this.recordingBps},{mimeType:"video/webm; codecs=h264",bitsPerSecond:this.recordingBps},{mimeType:"video/mp4; codecs=h264",bitsPerSecond:this.recordingBps},{mimeType:"video/webm",bitsPerSecond:this.recordingBps},{mimeType:"video/mp4",bitsPerSecond:this.recordingBps}],s=null,n=0;n<e.length;n++)if(MediaRecorder.isTypeSupported(e[n].mimeType)){s=e[n];break}if(!s){console.error("No supported codec found.");return}this.mediaRecorder=new MediaRecorder(t,s),this.mediaRecorder.ondataavailable=function(r){this.chunks.push(r.data)}.bind(this),this.mediaRecorder.onstop=function(){var r=new Blob(this.chunks,{type:s.mimeType}),o=URL.createObjectURL(r),a=document.createElement("a");a.href=o;var u=s.mimeType.split("/")[1].split(";")[0];a.download="playcanvas-gameplay."+u,this.app.inPlayCanvas?a.click():this.app.controller.sendMessage({event:"game_recording",data:{url:o}}),this.chunks=[]}.bind(this)},this.startRecording=function(){if(this.app.setting_recordGame===!0){var t=document.querySelector("canvas"),e=t.captureStream(this.targetFps/2);this.initializeMediaRecorder(e);var s=1e3/(this.targetFps/2);this.mediaRecorder.start(s)}},this.stopRecording=function(){this.app.setting_recordGame===!0&&this.mediaRecorder&&this.mediaRecorder.state==="recording"&&this.mediaRecorder.stop()}}}yt.AppRenderer=vt,(0,Xe.registerScript)(vt,"appRenderer"),vt.attributes.add("targetFps",{type:"number",default:30}),vt.attributes.add("recordingBps",{type:"number",default:25e4});var bt={};Object.defineProperty(bt,"__esModule",{value:!0}),bt.TextInput=void 0;const Ye=h.default;class x extends Ye.ScriptType{constructor(){super(...arguments),this.initialize=function(){this.app.activeTextInput=void 0,this.app.on("resetTextInput",()=>{this.reset()}),this.inputContainer.element.on("click",function(t){t.event.preventDefault(),this.setActive()},this),this.reset()},this.reset=function(){this.clearInputFocus(),this.app[this.textAppVar]="",this.textDisplay.element.text=this.clearText,this.app.fire("closeKeyboard")},this.setText=function(t){this.app[this.textAppVar]=t,this.app.gameController.setTextString(this.id,t===""?"NO ANSWER":this.app[this.textAppVar]),this.textDisplay.element.text=t===""?this.clearText:this.app[this.textAppVar],this.app.fire("currentInputText",this.app[this.textAppVar])},this.setActive=function(){if(this.app.activeTextInput!==this){this.app.activeTextInput!==void 0&&this.app.activeTextInput.setInactive(),this.app.activeTextInput=this,this.app.inputElement.value=this.app[this.textAppVar];const t=this.app.inputElement.value.length;this.app.inputElement.setSelectionRange(t,t),this.openKeyboard(100),this.highlightContainer.enabled=!0,this.app.logger.log("set active",this.id)}},this.setInactive=function(){this.highlightContainer.enabled=!1},this.clearInputFocus=function(){this.app.activeTextInput===this&&(this.app.fire("currentInputText",""),this.app.activeTextInput=void 0,this.setInactive(),this.closeKeyboard(0))},this.openKeyboard=function(t){window.setTimeout(function(){this.app.inputElement.focus(),this.app.fire("openKeyboard")}.bind(this),t)},this.closeKeyboard=function(t){window.setTimeout(function(){this.app.graphicsDevice.canvas.focus(),this.app.fire("closeKeyboard")}.bind(this),t)}}}bt.TextInput=x,(0,Ye.registerScript)(x,"textInput"),x.attributes.add("id",{type:"string"}),x.attributes.add("clearText",{type:"string",default:"Input Answer"}),x.attributes.add("textAppVar",{type:"string"}),x.attributes.add("fireOnTextSet",{type:"string"}),x.attributes.add("inputContainer",{type:"entity"}),x.attributes.add("highlightContainer",{type:"entity"}),x.attributes.add("textDisplay",{type:"entity"}),x.attributes.add("clearButtons",{type:"entity",array:!0});var Tt={};Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.Bloom=void 0;const qe=h.default,p=h.default;p.extend(p,function(){var i=15;function t(n,r){return 1/Math.sqrt(2*Math.PI*r)*Math.exp(-(n*n)/(2*r*r))}function e(n,r,o,a,u){n[0]=t(0,u),r[0]=0,r[1]=0;var y=n[0],d,c;for(d=0,c=Math.floor(i/2);d<c;d++){var m=t(d+1,u);n[d*2]=m,n[d*2+1]=m,y+=m*2;var g=d*2+1.5;r[d*4]=o*g,r[d*4+1]=a*g,r[d*4+2]=-o*g,r[d*4+3]=-a*g}for(d=0,c=n.length;d<c;d++)n[d]/=y}var s=function(n){var r={aPosition:p.SEMANTIC_POSITION},o=["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition + 1.0) * 0.5;","}"].join(`
`),a=["precision "+n.precision+" float;","","varying vec2 vUv0;","","uniform sampler2D uBaseTexture;","uniform float uBloomThreshold;","","void main(void)","{","    vec4 color = texture2D(uBaseTexture, vUv0);","","    gl_FragColor = clamp((color - uBloomThreshold) / (1.0 - uBloomThreshold), 0.0, 1.0);","}"].join(`
`),u=["precision "+n.precision+" float;","","#define SAMPLE_COUNT "+i,"","varying vec2 vUv0;","","uniform sampler2D uBloomTexture;","uniform vec2 uBlurOffsets[SAMPLE_COUNT];","uniform float uBlurWeights[SAMPLE_COUNT];","","void main(void)","{","    vec4 color = vec4(0.0);","    for (int i = 0; i < SAMPLE_COUNT; i++)","    {","        color += texture2D(uBloomTexture, vUv0 + uBlurOffsets[i]) * uBlurWeights[i];","    }","","    gl_FragColor = color;","}"].join(`
`),y=["precision "+n.precision+" float;","","varying vec2 vUv0;","","uniform float uBloomEffectIntensity;","uniform sampler2D uBaseTexture;","uniform sampler2D uBloomTexture;","","void main(void)","{","    vec4 bloom = texture2D(uBloomTexture, vUv0) * uBloomEffectIntensity;","    vec4 base = texture2D(uBaseTexture, vUv0);","","    base *= (1.0 - clamp(bloom, 0.0, 1.0));","","    gl_FragColor = base + bloom;","}"].join(`
`);this.extractShader=new p.Shader(n,{attributes:r,vshader:o,fshader:a}),this.blurShader=new p.Shader(n,{attributes:r,vshader:o,fshader:u}),this.combineShader=new p.Shader(n,{attributes:r,vshader:o,fshader:y});var d=n.width,c=n.height;this.targets=[];for(var m=0;m<2;m++){var g=new p.Texture(n,{format:p.PIXELFORMAT_R8_G8_B8_A8,width:d>>1,height:c>>1});g.minFilter=p.FILTER_LINEAR,g.magFilter=p.FILTER_LINEAR,g.addressU=p.ADDRESS_CLAMP_TO_EDGE,g.addressV=p.ADDRESS_CLAMP_TO_EDGE;var T=new p.RenderTarget({colorBuffer:g,depth:!1});this.targets.push(T)}this.bloomThreshold=.25,this.blurAmount=4,this.bloomIntensity=1.25,this.sampleWeights=new Float32Array(i),this.sampleOffsets=new Float32Array(i*2)};return p.inherits(s,p.PostEffect),s.prototype=p.extend(s.prototype,{render:function(n,r,o){var a=this.device,u=a.scope;u.resolve("uBloomThreshold").setValue(this.bloomThreshold),u.resolve("uBaseTexture").setValue(n.colorBuffer),p.drawFullscreenQuad(a,this.targets[0],this.vertexBuffer,this.extractShader,o),e(this.sampleWeights,this.sampleOffsets,1/this.targets[1].width,0,this.blurAmount),u.resolve("uBlurWeights[0]").setValue(this.sampleWeights),u.resolve("uBlurOffsets[0]").setValue(this.sampleOffsets),u.resolve("uBloomTexture").setValue(this.targets[0].colorBuffer),p.drawFullscreenQuad(a,this.targets[1],this.vertexBuffer,this.blurShader,o),e(this.sampleWeights,this.sampleOffsets,0,1/this.targets[0].height,this.blurAmount),u.resolve("uBlurWeights[0]").setValue(this.sampleWeights),u.resolve("uBlurOffsets[0]").setValue(this.sampleOffsets),u.resolve("uBloomTexture").setValue(this.targets[1].colorBuffer),p.drawFullscreenQuad(a,this.targets[0],this.vertexBuffer,this.blurShader,o),u.resolve("uBloomEffectIntensity").setValue(this.bloomIntensity),u.resolve("uBloomTexture").setValue(this.targets[0].colorBuffer),u.resolve("uBaseTexture").setValue(n.colorBuffer),p.drawFullscreenQuad(a,r,this.vertexBuffer,this.combineShader,o)}}),{BloomEffect:s}}());class G extends qe.ScriptType{constructor(){super(...arguments),this.initialize=function(){this.effect=new p.BloomEffect(this.app.graphicsDevice),this.effect.bloomThreshold=this.bloomThreshold,this.effect.blurAmount=this.blurAmount,this.effect.bloomIntensity=this.bloomIntensity;var t=this.entity.camera.postEffects;t.addEffect(this.effect),this.on("attr",function(e,s){this.effect[e]=s},this),this.on("state",function(e){e?t.addEffect(this.effect):t.removeEffect(this.effect)}),this.on("destroy",function(){t.removeEffect(this.effect)})}}}Tt.Bloom=G,(0,qe.registerScript)(G,"bloom"),G.attributes.add("bloomIntensity",{type:"number",default:1,min:0,title:"Intensity"}),G.attributes.add("bloomThreshold",{type:"number",default:.25,min:0,max:1,precision:2,title:"Threshold"}),G.attributes.add("blurAmount",{type:"number",default:4,min:1,title:"Blur amount"});var St={};Object.defineProperty(St,"__esModule",{value:!0}),St.ButtonSetMenu=void 0;const Je=h.default;class Qe extends Je.ScriptType{constructor(){super(...arguments),this.initialize=function(){this.entity.button.on("click",()=>{this.app.menuName=this.toMenu,this.app.fire("menuSet"),this.app.logger.log("set menu",this.toMenu)})}}}St.ButtonSetMenu=Qe,(0,Je.registerScript)(Qe,"buttonSetMenu");var _t={};Object.defineProperty(_t,"__esModule",{value:!0}),_t.ButtonSetState=void 0;const ti=h.default;class ei extends ti.ScriptType{constructor(){super(...arguments),this.initialize=function(){this.entity.button.on("click",()=>{this.app.controller.forceSetState(this.toState)})}}}_t.ButtonSetState=ei,(0,ti.registerScript)(ei,"buttonSetState");var xt={};Object.defineProperty(xt,"__esModule",{value:!0}),xt.ButtonFireEvent=void 0;const ii=h.default;class se extends ii.ScriptType{constructor(){super(...arguments),this.initialize=function(){this.entity.button.on("click",()=>this.app.fire(this.eventToFire))}}}xt.ButtonFireEvent=se,(0,ii.registerScript)(se,"buttonFireEvent"),se.attributes.add("eventToFire",{type:"string"});var Et={};Object.defineProperty(Et,"__esModule",{value:!0}),Et.Ccd=void 0;const si=h.default;class Mt extends si.ScriptType{constructor(){super(...arguments),this.initialize=function(){var t;t=this.entity.rigidbody.body,t.setCcdMotionThreshold(this.motionThreshold),t.setCcdSweptSphereRadius(this.sweptSphereRadius),t.setContactProcessingThreshold(1e30),this.on("attr:motionThreshold",function(e,s){t=this.entity.rigidbody.body,t.setCcdMotionThreshold(e)}),this.on("attr:sweptSphereRadius",function(e,s){t=this.entity.rigidbody.body,t.setCcdSweptSphereRadius(e)})}}}Et.Ccd=Mt,(0,si.registerScript)(Mt,"ccd"),Mt.attributes.add("motionThreshold",{type:"number",default:1,title:"Motion Threshold",description:"Number of meters moved in one frame before CCD is enabled"}),Mt.attributes.add("sweptSphereRadius",{type:"number",default:.2,title:"Swept Sphere Radius",description:"This should be below the half extent of the collision volume. E.g For an object of dimensions 1 meter, try 0.2"});var Ct={};Object.defineProperty(Ct,"__esModule",{value:!0}),Ct.KalikratisEditorPath=void 0;const ni=h.default,l=h.default;class b extends ni.ScriptType{constructor(){super(...arguments),this.initialize=function(){this.vec=new l.Vec3,this.vec2=new l.Vec3,this.numberOfChildren=void 0,this.position=new l.Vec3,this.lookAt=new l.Vec3,this.up=new l.Vec3,this.animationDirection=1,this.percent=0,this.prepare(),this.getCurvesFromPath(),this.lapsDone=0,this.doAnimate=!0},this.update=function(e){this.doAnimate===!0&&(this.percent+=e*this.moveSpeed,this.percent>=1&&(this.percent=0),this.animate(this.percent))},this.animate=function(e){this.position.set(this.path.px.value(e),this.path.py.value(e),this.path.pz.value(e)),this.lookAt.set(this.path.tx.value(e),this.path.ty.value(e),this.path.tz.value(e)),this.up.set(this.path.ux.value(e),this.path.uy.value(e),this.path.uz.value(e)),this.animationEntity.setPosition(this.position),this.animationEntity.lookAt(this.lookAt),this.animationEntity.up.set(this.up)},this.isInEditor=function(){var e;return window.Uranus!==void 0&&e.Editor&&e.Editor.inEditor()===!0},this.prepare=function(){this.isInEditor()&&(this.editorTranslationCallback=this.getCurvesFromPath.bind(this),this.updateEditorTranslationListeners())},this._getListeners=function(){function e(s){return[s,s.children.map(n=>e(n))]}return e(this.entity).flat(1e4)},this.updateEditorTranslationListeners=function(){const e=this._getNodes();var s;this.numberOfChildren=e.length,this._getListeners().forEach(r=>{const o=s.call("entities:get",r._guid);o.unbind("position:set",this.editorTranslationCallback),o.on("position:set",this.editorTranslationCallback),o.unbind("rotation:set",this.editorTranslationCallback),o.on("rotation:set",this.editorTranslationCallback),o.unbind("scale:set",this.editorTranslationCallback),o.on("scale:set",this.editorTranslationCallback)})},this.editorInitialize=function(){const e=window.document.styleSheets[0];e.insertRule(".active-block-builder-button { background-color: #f60 !important; color: white !important; }",e.cssRules.length)},this.editorAttrChange=function(e){e==="curveType"&&this.getCurvesFromPath(),(e==="duration"||e==="loopAnimation"||e==="yoyoAnimation"||e==="animationEntity")&&this.resetAnimation()},this.editorScriptPanelRender=function(e){const s=e.firstChild;var n;const r=new n.Button({text:"+ Toggle Animation"});r.on("click",()=>{this.isPlaying=!this.isPlaying,this.setEditorPlaying(r)}),s.append(r.element),this.setEditorPlaying(r);const o=new n.Button({text:"- Reset Animation"});o.on("click",this.resetAnimation,this),s.append(o.element)},this.resetAnimation=function(){this.time=0,this.animate(0)},this.setEditorPlaying=function(e){this.isPlaying?e.element.classList.add("active-block-builder-button"):e.element.classList.remove("active-block-builder-button")},this._getNodes=function(){function e(s){return s.children.length===0?[s]:s.children.map(n=>e(n))}return e(this.entity).flat(1e4)},this.getCurvesFromPath=function(){if(this.path&&this.isStatic===!0)return;const e=this.curveType,s={pathLength:0};s.px=new l.Curve,s.px.type=e,s.py=new l.Curve,s.py.type=e,s.pz=new l.Curve,s.pz.type=e,s.tx=new l.Curve,s.tx.type=e,s.ty=new l.Curve,s.ty.type=e,s.tz=new l.Curve,s.tz.type=e,s.ux=new l.Curve,s.ux.type=e,s.uy=new l.Curve,s.uy.type=e,s.uz=new l.Curve,s.uz.type=e;const n=this._getNodes(),r=[],o=new l.Vec3;r.push(0);for(let a=1;a<n.length;++a){const u=n[a-1],y=n[a];o.sub2(u.getPosition(),y.getPosition()),s.pathLength+=o.length(),r.push(s.pathLength)}for(let a=0;a<n.length;++a){const u=r[a]/s.pathLength,y=n[a],d=y.getPosition();s.px.add(u,d.x),s.py.add(u,d.y),s.pz.add(u,d.z);const c=d.clone().add(y.forward);s.tx.add(u,c.x),s.ty.add(u,c.y),s.tz.add(u,c.z);const{up:m}=y;s.ux.add(u,m.x),s.uy.add(u,m.y),s.uz.add(u,m.z)}s.getPosition=a=>new l.Vec3(s.px.value(a),s.py.value(a),s.pz.value(a)),s.getLookAt=a=>new l.Vec3(s.tx.value(a),s.ty.value(a),s.tz.value(a)),s.getUp=a=>new l.Vec3(s.ux.value(a),s.uy.value(a),s.uz.value(a)),this.path=s},this.drawLine=function(){if(!this.path||this.path.length===0)return!1;const{path:e}=this,s=Math.ceil(e.pathLength/this.renderStep);let n=0,r=0,o=0;for(let a=0;a<=s&&!(o>=1);++a)n+=this.renderStep,o=n/e.pathLength,o>1&&(o=1),this._drawNode(e,o,r),r=o;return!0},this._drawNode=function({px:e,py:s,pz:n,ux:r,uy:o,uz:a,tx:u,ty:y,tz:d},c,m){const g=new l.Vec3(e.value(m),s.value(m),n.value(m)),T=new l.Vec3(e.value(c),s.value(c),n.value(c)),U=new l.Vec3(r.value(c),o.value(c),a.value(c)),Lt=new l.Vec3(u.value(c),y.value(c),d.value(c)).sub(T).normalize(),j=new l.Vec3().cross(Lt,U),k=.5,Rt=new l.Vec3().add2(T,U.clone().scale(.01)),Ft=new l.Vec3().add2(T,Lt.clone().scale(.1)),D=new l.Vec3().add2(T,j.clone().scale(k)),B=new l.Vec3().add2(T,j.clone().scale(-k)),re=new l.Vec3().add2(g,j.clone().scale(k)),oe=new l.Vec3().add2(g,j.clone().scale(-k)),ae=new l.Vec3().add2(D,U.clone().scale(.05)),ue=new l.Vec3().add2(B,U.clone().scale(.05));this.app.renderLine(g,T,this.renderColor),this.app.renderLine(re,D,this.renderColor),this.app.renderLine(oe,B,this.renderColor),this.app.renderLine(T,Rt,l.Color.RED),this.app.renderLine(D,ae,l.Color.RED),this.app.renderLine(B,ue,l.Color.RED),this.app.renderLine(T,Ft,l.Color.CYAN),this.app.renderLine(D,B,l.Color.CYAN)},this._isDirty=function(){return this._getListeners().some(({_dirtyWorld:e})=>e)},this.monitorPointChanges=function(){this._isDirty()&&this.getCurvesFromPath()}}}Ct.KalikratisEditorPath=b,(0,ni.registerScript)(b,"kalikratisEditorPath"),b.attributes.add("renderLine",{type:"boolean",default:!0,title:"Render Line",description:"If checked the line will be rendered in scene (works both in editor and on launch)."}),b.attributes.add("renderColor",{type:"rgba",title:"Render Color",description:"The color of the line to render."}),b.attributes.add("renderStep",{type:"number",default:.25,title:"Render Step",description:"The length of each line segment rendered."}),b.attributes.add("curveType",{type:"number",default:3,enum:[{CURVE_LINEAR:0},{CURVE_SMOOTHSTEP:1},{CURVE_CATMULL:2},{CURVE_CARDINAL:3},{CURVE_SPLINE:4},{CURVE_STEP:5}],title:"Curve Type",description:"The type of the line curve rendered."}),b.attributes.add("isStatic",{type:"boolean",default:!1,title:"Is Static",description:"If checked the line will not update if any point gets updated (performance optimization)."}),b.attributes.add("animationEntity",{type:"entity",title:"Animation Entity",description:"The entity to animate on the path."}),b.attributes.add("loopAnimation",{type:"boolean",default:!0,title:"Loop Animation",description:"If selected the animation will loop infinitely."}),b.attributes.add("yoyoAnimation",{type:"boolean",default:!1,title:"Yoyo Animation",description:"If selected and Loop Animation is also selected the animation will yoyo back when looping."}),b.attributes.add("autoplay",{type:"boolean",default:!0,title:"Auto Play",description:"If selected the animation will automatically start when this entity is initialized."}),b.attributes.add("moveSpeed",{type:"number",default:1});var Pt={};Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.ScoreCollision=void 0;const ri=h.default;class R extends ri.ScriptType{constructor(){super(...arguments),this.initialize=function(){this.canScore=this.startHittable,this.entity.collision.on("triggerenter",this.onTriggerEnter,this)},this.hit=function(t){this.disableScoreOnHit===!0&&(this.canScore=!1),this.entity.fire("scored",t),this.appFireOnScore!==""&&this.app.fire(this.appFireOnScore,t),this.entityFireOnScore!==""&&this.entity.fire(this.entityFireOnScore,t)},this.onTriggerEnter=function(t){this.app.logger.log("scoreObj trigger",t,t.scripts),t.script.projectileController!==void 0&&t.script.projectileController.checkIfScored(this.entity)},this.setScoreable=function(t){this.canScore=t}}}Pt.ScoreCollision=R,(0,ri.registerScript)(R,"scoreCollision"),R.attributes.add("pointsModifier",{type:"number"}),R.attributes.add("startHittable",{type:"boolean",default:!0}),R.attributes.add("disableScoreOnHit",{type:"boolean",default:!1}),R.attributes.add("appFireOnScore",{type:"string"}),R.attributes.add("entityFireOnScore",{type:"string"});var wt={};Object.defineProperty(wt,"__esModule",{value:!0}),wt.TransformPingPong=void 0;const oi=h.default,ne=h.default;class V extends oi.ScriptType{constructor(){super(...arguments),this.initialize=function(){this.start("x"),this.start("y"),this.start("z")},this.start=function(t){this[t+"To"]=0,this.pingPongScale[t]!==0&&this.startTween(t)},this.startTween=function(t){var e=this.pingPongMinTime[t],s=this.pingPongMaxTime[t],n=e===s?e:ne.math.random(e,s),r=this.entity.getLocalPosition(),o=r[t]<=0?this.pingPongScale[t]:-this.pingPongScale[t],a={num:r[t]};this["tween"+t]&&this["tween"+t].stop();var u=ne[this.tweenType];this["tween"+t]=this.entity.tween(a).to({num:o},n,u).on("update",()=>{this[t+"To"]=a.num}).on("complete",()=>{this.startTween(t)}).start()},this.update=function(t){this.entity.setLocalPosition(new ne.Vec3(this.xTo,this.yTo,this.zTo))}}}wt.TransformPingPong=V,(0,oi.registerScript)(V,"transformPingPong"),V.attributes.add("tweenType",{type:"string",default:"SineInOut"}),V.attributes.add("pingPongScale",{type:"vec3"}),V.attributes.add("pingPongMinTime",{type:"vec3"}),V.attributes.add("pingPongMaxTime",{type:"vec3"});var Ot={};Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.TransformRotate=void 0;const ai=h.default;class It extends ai.ScriptType{constructor(){super(...arguments),this.initialize=function(){var t=this.entity.getLocalEulerAngles();this.rotX=t.x,this.rotY=t.y,this.rotZ=t.z},this.update=function(t){this.rotX+=t*this.rotSpeed.x,this.rotY+=t*this.rotSpeed.y,this.rotZ+=t*this.rotSpeed.z;for(let e=0;e<this.rotObjs.length;++e)this.rotObjs[e].setLocalEulerAngles(this.rotX,this.rotY,this.rotZ)}}}Ot.TransformRotate=It,(0,ai.registerScript)(It,"transformRotate"),It.attributes.add("rotObjs",{type:"entity",array:!0}),It.attributes.add("rotSpeed",{type:"vec3",default:[0,1,0]});var At={};Object.defineProperty(At,"__esModule",{value:!0}),At.Logger=void 0;const ui=h.default;class li extends ui.ScriptType{constructor(){super(...arguments),this.initialize=function(){this.app.logger=this},this.log=function(...t){this.app.inPlayCanvas===!0&&console.log(...t)},this.warn=function(...t){console.warn(...t)},this.error=function(...t){console.error(...t)}}}At.Logger=li,(0,ui.registerScript)(li,"logger"),function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.InputMouseTouch=i.Random=i.UiLeaderboard=i.TransformRotate=i.TransformPingPong=i.TextInput=i.setGameInfo=i.SetTextFont=i.SetTextOnEvent=i.SetParticleColor=i.SetUiTexture=i.SetUiColor=i.SetMaterialVideoTexture=i.SetMaterialTexture=i.SetMaterialColor=i.ScoreCollision=i.SceneLoader=i.KalikratisEditorPath=i.EnableUiMulti=i.DeleteAfterTime=i.Ccd=i.ButtonSetState=i.ButtonSetMenu=i.ButtonFireEvent=i.Bloom=i.AppController=i.Logger=i.AppRenderer=void 0;const t=qt;Object.defineProperty(i,"Random",{enumerable:!0,get:function(){return t.Random}});const e=Q;Object.defineProperty(i,"AppController",{enumerable:!0,get:function(){return e.AppController}});const s=tt;Object.defineProperty(i,"EnableUiMulti",{enumerable:!0,get:function(){return s.EnableUiMulti}});const n=et;Object.defineProperty(i,"DeleteAfterTime",{enumerable:!0,get:function(){return n.DeleteAfterTime}});const r=it;Object.defineProperty(i,"SceneLoader",{enumerable:!0,get:function(){return r.SceneLoader}});const o=st;Object.defineProperty(i,"SetMaterialColor",{enumerable:!0,get:function(){return o.SetMaterialColor}});const a=rt;Object.defineProperty(i,"SetMaterialTexture",{enumerable:!0,get:function(){return a.SetMaterialTexture}});const u=at;Object.defineProperty(i,"SetMaterialVideoTexture",{enumerable:!0,get:function(){return u.SetMaterialVideoTexture}});const y=ut;Object.defineProperty(i,"SetTextOnEvent",{enumerable:!0,get:function(){return y.SetTextOnEvent}});const d=lt;Object.defineProperty(i,"SetTextFont",{enumerable:!0,get:function(){return d.SetTextFont}});const c=ht;Object.defineProperty(i,"SetUiColor",{enumerable:!0,get:function(){return c.SetUiColor}});const m=dt;Object.defineProperty(i,"SetUiTexture",{enumerable:!0,get:function(){return m.SetUiTexture}});const g=pt;Object.defineProperty(i,"SetParticleColor",{enumerable:!0,get:function(){return g.SetParticleColor}});const T=ft;Object.defineProperty(i,"UiLeaderboard",{enumerable:!0,get:function(){return T.UiLeaderboard}});const U=gt;Object.defineProperty(i,"InputMouseTouch",{enumerable:!0,get:function(){return U.InputMouseTouch}});const Lt=yt;Object.defineProperty(i,"AppRenderer",{enumerable:!0,get:function(){return Lt.AppRenderer}});const j=bt;Object.defineProperty(i,"TextInput",{enumerable:!0,get:function(){return j.TextInput}});const k=Tt;Object.defineProperty(i,"Bloom",{enumerable:!0,get:function(){return k.Bloom}});const Rt=St;Object.defineProperty(i,"ButtonSetMenu",{enumerable:!0,get:function(){return Rt.ButtonSetMenu}});const Ft=_t;Object.defineProperty(i,"ButtonSetState",{enumerable:!0,get:function(){return Ft.ButtonSetState}});const D=xt;Object.defineProperty(i,"ButtonFireEvent",{enumerable:!0,get:function(){return D.ButtonFireEvent}});const B=Et;Object.defineProperty(i,"Ccd",{enumerable:!0,get:function(){return B.Ccd}});const re=Ct;Object.defineProperty(i,"KalikratisEditorPath",{enumerable:!0,get:function(){return re.KalikratisEditorPath}});const oe=Pt;Object.defineProperty(i,"ScoreCollision",{enumerable:!0,get:function(){return oe.ScoreCollision}});const ae=wt;Object.defineProperty(i,"TransformPingPong",{enumerable:!0,get:function(){return ae.TransformPingPong}});const ue=Ot;Object.defineProperty(i,"TransformRotate",{enumerable:!0,get:function(){return ue.TransformRotate}});const ki=At;Object.defineProperty(i,"Logger",{enumerable:!0,get:function(){return ki.Logger}});const Di=Bi=>{const{gameId:Ki,gameVersion:$i,gameModes:Ni,colorKeys:le,textureKeys:hi,videoKeys:zi,states:Gi,menus:Wi}=Bi;e.AppController.attributes.add("playcanvasTestMode",{title:"Playcanvas Test Mode",type:"string",default:"freeplay",enum:Ni,description:"Test Mode for playcanvas, tested update"}),o.SetMaterialColor.attributes.add("colorKey",{type:"string",enum:le}),c.SetUiColor.attributes.add("colorKey",{type:"string",enum:le}),g.SetParticleColor.attributes.add("colorKey",{type:"string",enum:le,array:!0}),a.SetMaterialTexture.attributes.add("textureKey",{type:"string",enum:hi}),m.SetUiTexture.attributes.add("textureKey",{type:"string",enum:hi}),u.SetMaterialVideoTexture.attributes.add("videoKey",{type:"string",enum:zi}),Rt.ButtonSetMenu.attributes.add("toMenu",{type:"string"}),Ft.ButtonSetState.attributes.add("toState",{type:"string"}),s.EnableUiMulti.attributes.add("enabledMenus",{type:"string",array:!0}),s.EnableUiMulti.attributes.add("enabledStates",{type:"string",array:!0})};i.setGameInfo=Di}(he),he.setGameInfo(pi),console.log("Template Mobile Build =",void 0)})(pc);
